<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Explorer</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="window">
        <!-- Title Bar -->
        <div class="title-bar">
            <div class="title-bar-text">File Explorer</div>
            <div class="title-bar-controls">
                <button aria-label="Minimize"></button>
                <button aria-label="Maximize"></button>
                <button style="color: red;" aria-label="Close" onclick="closeApplication()">√ó</button>
            </div>
        </div>

        <!-- Menu Bar -->
        <div class="menu-bar">
            <div class="menu-item">
                <button class="menu-button" id="file-menu-btn">File</button>
                <div class="menu-dropdown" id="file-menu">
                    <div class="menu-item-option" onclick="window.location.href='/'">Go to Home</div>
                    <div class="menu-item-option" onclick="window.history.back()">Go Back</div>
                    <div class="menu-item-option" onclick="window.history.forward()">Go Forward</div>
                    <div class="menu-separator"></div>
                    <div class="menu-item-option" onclick="showCreateFileModal()">Create File</div>
                    <div class="menu-item-option" onclick="showCreateFolderModal()">Create Folder</div>
                    <div class="menu-item-option" onclick="showUploadModal()">Upload File</div>
                    <div class="menu-separator"></div>
                    <div class="menu-item-option" onclick="window.location.reload()">Refresh</div>
                </div>
            </div>
            <div class="menu-item">
                <button class="menu-button" id="edit-menu-btn">Edit</button>
                <div class="menu-dropdown" id="edit-menu">
                    <div class="menu-item-option" id="select-all-option" onclick="toggleSelectAll()">Select All</div>
                    <div class="menu-item-option" onclick="copyPath()">Copy Current Path</div>
                </div>
            </div>
            <div class="menu-item">
                <button class="menu-button" id="view-menu-btn">View</button>
                <div class="menu-dropdown" id="view-menu">
                    <div class="menu-item-option" onclick="setViewMode('list')" id="view-list-option">List View</div>
                    <div class="menu-item-option" onclick="setViewMode('grid')" id="view-grid-option">Grid View</div>
                    <div class="menu-separator"></div>
                    <div class="menu-item-option" onclick="showHiddenFiles()">Show Hidden Files</div>
                </div>
            </div>
            <div class="menu-item">
                <button class="menu-button" id="help-menu-btn">Help</button>
                <div class="menu-dropdown" id="help-menu">
                    <div class="menu-item-option" onclick="showAbout()">About File Explorer</div>
                    <div class="menu-item-option" onclick="showShortcuts()">Keyboard Shortcuts</div>
                </div>
            </div>
        </div>

        <!-- Toolbar -->
        <div class="toolbar">
            <button class="toolbar-button" onclick="window.location.href='/'">
                <span class="icon">üè†</span> Home
            </button>
            <button class="toolbar-button" onclick="window.history.back()">
                <span class="icon">‚óÄ</span> Back
            </button>
            <button class="toolbar-button" onclick="window.history.forward()">
                <span class="icon">‚ñ∂</span> Forward
            </button>
        </div>

        <!-- Breadcrumb Navigation -->
        <div class="breadcrumb-container">
            <nav class="breadcrumb">
                {% for crumb in breadcrumbs %}
                    {% if loop.last %}
                        <span class="breadcrumb-item active">{{ crumb.name }}</span>
                    {% else %}
                        <a href="{{ url_for('explorer', subpath=crumb.path) }}" class="breadcrumb-item">
                            {{ crumb.name }}
                        </a>
                        <span class="breadcrumb-separator">/</span>
                    {% endif %}
                {% endfor %}
            </nav>
        </div>

        <!-- File List Container -->
        <div class="file-list-container" id="file-list-container" data-current-path="{{ current_path }}">
            <!-- List View -->
            <table class="file-list" id="list-view">
                <thead>
                    <tr>
                        <th class="col-name">Name</th>
                        <th class="col-type">Type</th>
                        <th class="col-size">Size</th>
                        <th class="col-modified">Modified</th>
                    </tr>
                </thead>
                <tbody>
                    {% if current_path %}
                    <tr class="file-item" onclick="window.location.href='{{ url_for('explorer', subpath='') }}'">
                        <td class="col-name">
                            <span class="file-icon folder-icon">üìÅ</span>
                            <span class="file-name">..</span>
                            <button class="file-options-btn" style="visibility: hidden;" title="Options">‚ãØ</button>
                        </td>
                        <td class="col-type">Folder</td>
                        <td class="col-size">-</td>
                        <td class="col-modified">-</td>
                    </tr>
                    {% endif %}
                    
                    {% for item in items %}
                    <tr class="file-item {% if item.is_dir %}folder{% else %}file{% endif %}" 
                        data-path="{{ item.relative_path }}"
                        data-name="{{ item.name }}"
                        data-is-dir="{{ 'true' if item.is_dir else 'false' }}"
                        data-is-media="{{ 'true' if item.is_media else 'false' }}"
                        onclick="handleFileClick(event, '{{ item.relative_path }}', {{ 'true' if item.is_dir else 'false' }}, {{ 'true' if item.is_media else 'false' }})">
                        <td class="col-name">
                            {% if item.is_dir %}
                                <span class="file-icon folder-icon">üìÅ</span>
                            {% elif item.is_image %}
                                <img src="{{ url_for('preview', filepath=item.relative_path) }}" 
                                     alt="{{ item.name }}" 
                                     class="file-thumbnail"
                                     onerror="this.style.display='none'; this.nextElementSibling.style.display='inline';">
                                <span class="file-icon file-icon" style="display: none;">üñºÔ∏è</span>
                            {% elif item.is_video %}
                                <span class="file-icon file-icon">üé¨</span>
                            {% else %}
                                <span class="file-icon file-icon">üìÑ</span>
                            {% endif %}
                            <span class="file-name">{{ item.name }}</span>
                            <button class="file-options-btn" 
                                    onclick="event.stopPropagation(); showFileOptions(event, '{{ item.relative_path }}', {{ 'true' if item.is_dir else 'false' }})"
                                    title="Options">‚ãØ</button>
                        </td>
                        <td class="col-type">{{ 'Folder' if item.is_dir else ('Image' if item.is_image else ('Video' if item.is_video else 'File')) }}</td>
                        <td class="col-size">{{ item.size }}</td>
                        <td class="col-modified">{{ item.modified }}</td>
                    </tr>
                    {% endfor %}
                    
                    {% if not items and not current_path %}
                    <tr>
                        <td colspan="4" class="empty-message">No files or folders found.</td>
                    </tr>
                    {% endif %}
                </tbody>
            </table>
            
            <!-- Grid View -->
            <div class="file-grid" id="grid-view" style="display: none;">
                {% if current_path %}
                <div class="grid-item folder" onclick="window.location.href='{{ url_for('explorer', subpath='') }}'">
                    <div class="grid-icon">üìÅ</div>
                    <div class="grid-name">..</div>
                </div>
                {% endif %}
                
                {% for item in items %}
                <div class="grid-item {% if item.is_dir %}folder{% else %}file{% endif %}" 
                     data-path="{{ item.relative_path }}"
                     data-is-dir="{{ 'true' if item.is_dir else 'false' }}"
                     data-is-media="{{ 'true' if item.is_media else 'false' }}"
                     onclick="handleFileClick(event, '{{ item.relative_path }}', {{ 'true' if item.is_dir else 'false' }}, {{ 'true' if item.is_media else 'false' }})"
                     oncontextmenu="event.preventDefault(); showContextMenu(event, '{{ item.relative_path }}', {{ 'true' if item.is_dir else 'false' }})">
                    {% if item.is_dir %}
                        <div class="grid-icon">üìÅ</div>
                    {% elif item.is_image %}
                        <img src="{{ url_for('preview', filepath=item.relative_path) }}" 
                             alt="{{ item.name }}" 
                             class="grid-thumbnail"
                             onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                        <div class="grid-icon" style="display: none;">üñºÔ∏è</div>
                    {% elif item.is_video %}
                        <div class="grid-icon">üé¨</div>
                    {% else %}
                        <div class="grid-icon">üìÑ</div>
                    {% endif %}
                    <div class="grid-name">{{ item.name }}</div>
                    <button class="grid-options-btn" 
                            onclick="event.stopPropagation(); showFileOptions(event, '{{ item.relative_path }}', {{ 'true' if item.is_dir else 'false' }})"
                            title="Options">‚ãØ</button>
                </div>
                {% endfor %}
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar">
            <div class="status-bar-field">
                {% if items %}
                    {{ items|length }} item{{ 's' if items|length != 1 else '' }}
                {% else %}
                    0 items
                {% endif %}
            </div>
            <div class="status-bar-field" style="position: relative;">
                {% if current_path %}
                    {{ current_path }}
                {% else %}
                    {{ root_dir }}
                {% endif %}
                <div class="zoom-control" style="position: absolute; right: 4px; top: 50%; transform: translateY(-50%); display: flex; align-items: center; gap: 4px;">
                    <button class="zoom-btn" onclick="adjustZoom(-10)" title="Zoom Out">‚àí</button>
                    <span class="zoom-level" id="zoom-level">100%</span>
                    <button class="zoom-btn" onclick="adjustZoom(10)" title="Zoom In">+</button>
                    <button class="zoom-reset-btn" onclick="resetZoom()" title="Reset Zoom">‚ü≤</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Preview Modal -->
    <div id="preview-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title-bar">
                <div class="modal-title-text" id="preview-title">Preview</div>
                <button class="modal-close" onclick="closePreview()" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <div id="preview-container">
                    <img id="preview-image" alt="Preview">
                    <video id="preview-video" controls>
                        Your browser does not support the video tag.
                    </video>
                </div>
                <div class="preview-actions">
                    <button class="button-primary" onclick="downloadPreview()">Download</button>
                    <button class="button-secondary" onclick="closePreview()">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- About Modal -->
    <div id="about-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-title-bar">
                <div class="modal-title-text">About File Explorer</div>
                <button class="modal-close" onclick="closeModal('about-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <p><strong>Flask File Explorer</strong></p>
                <p>A retro-styled file browser for local network access.</p>
                <p>Version 1.0</p>
                <p>Built with Flask and classic UI design.</p>
                <button class="button-primary" onclick="closeModal('about-modal')">OK</button>
            </div>
        </div>
    </div>

    <!-- Shortcuts Modal -->
    <div id="shortcuts-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-title-bar">
                <div class="modal-title-text">Keyboard Shortcuts</div>
                <button class="modal-close" onclick="closeModal('shortcuts-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <div class="shortcuts-list">
                    <div class="shortcut-item">
                        <span class="shortcut-key">Enter</span>
                        <span class="shortcut-desc">Open file/folder</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Backspace</span>
                        <span class="shortcut-desc">Go to parent folder</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Home</span>
                        <span class="shortcut-desc">Go to root directory</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">F5</span>
                        <span class="shortcut-desc">Refresh</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="shortcut-key">Esc</span>
                        <span class="shortcut-desc">Close preview/modal</span>
                    </div>
                </div>
                <button class="button-primary" onclick="closeModal('shortcuts-modal')">OK</button>
            </div>
        </div>
    </div>

    <!-- File Options Menu -->
    <div id="file-options-menu" class="context-menu">
        <div class="context-menu-item" id="opt-info">
            <span class="ctx-icon">‚ÑπÔ∏è</span> Information
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="opt-rename">
            <span class="ctx-icon">‚úèÔ∏è</span> Rename
        </div>
        <div class="context-menu-item" id="opt-copy">
            <span class="ctx-icon">üìã</span> Copy
        </div>
        <div class="context-menu-item" id="opt-cut">
            <span class="ctx-icon">‚úÇÔ∏è</span> Cut
        </div>
        <div class="context-menu-item" id="opt-paste" style="display: none;">
            <span class="ctx-icon">üìÑ</span> Paste
        </div>
        <div class="context-menu-item" id="opt-move">
            <span class="ctx-icon">üì¶</span> Move
        </div>
        <div class="context-menu-separator"></div>
        <div class="context-menu-item" id="opt-delete">
            <span class="ctx-icon">üóëÔ∏è</span> Delete
        </div>
    </div>

    <!-- Context Menu -->
    <div id="context-menu" class="context-menu">
        <div class="context-menu-item" id="ctx-upload-file">
            <span class="ctx-icon">üì§</span> Upload File
        </div>
        <div class="context-menu-item" id="ctx-create-file">
            <span class="ctx-icon">üìÑ</span> Create File
        </div>
        <div class="context-menu-item" id="ctx-create-folder">
            <span class="ctx-icon">üìÅ</span> Create Folder
        </div>
        <div class="context-menu-separator" id="ctx-separator-1"></div>
        <div class="context-menu-item" id="ctx-paste" style="display: none;">
            <span class="ctx-icon">üìÑ</span> Paste
        </div>
        <div class="context-menu-item" id="ctx-delete" style="display: none;">
            <span class="ctx-icon">üóëÔ∏è</span> Delete
        </div>
    </div>

    <!-- Upload File Modal -->
    <div id="upload-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-title-bar">
                <div class="modal-title-text">Upload File</div>
                <button class="modal-close" onclick="closeModal('upload-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <form id="upload-form" enctype="multipart/form-data">
                    <input type="hidden" id="upload-directory" name="directory" value="{{ current_path }}">
                    <div class="form-group">
                        <label for="file-input" class="form-label">Select File:</label>
                        <input type="file" id="file-input" name="file" class="form-input" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="button-primary">Upload</button>
                        <button type="button" class="button-secondary" onclick="closeModal('upload-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create File Modal -->
    <div id="create-file-modal" class="modal">
        <div class="modal-content">
            <div class="modal-title-bar">
                <div class="modal-title-text">Create New File</div>
                <button class="modal-close" onclick="closeModal('create-file-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <form id="create-file-form">
                    <input type="hidden" id="create-file-directory" name="directory" value="{{ current_path }}">
                    <div class="form-group">
                        <label for="filename-input" class="form-label">Filename:</label>
                        <input type="text" id="filename-input" name="filename" class="form-input" placeholder="example.txt" required>
                    </div>
                    <div class="form-group">
                        <label for="file-content-input" class="form-label">Content (optional):</label>
                        <textarea id="file-content-input" name="content" class="form-textarea" rows="10" placeholder="File content..."></textarea>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="button-primary">Create</button>
                        <button type="button" class="button-secondary" onclick="closeModal('create-file-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Create Folder Modal -->
    <div id="create-folder-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-title-bar">
                <div class="modal-title-text">Create New Folder</div>
                <button class="modal-close" onclick="closeModal('create-folder-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <form id="create-folder-form">
                    <input type="hidden" id="create-folder-directory" name="directory" value="{{ current_path }}">
                    <div class="form-group">
                        <label for="foldername-input" class="form-label">Folder Name:</label>
                        <input type="text" id="foldername-input" name="foldername" class="form-input" placeholder="New Folder" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="button-primary">Create</button>
                        <button type="button" class="button-secondary" onclick="closeModal('create-folder-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="rename-modal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-title-bar">
                <div class="modal-title-text">Rename</div>
                <button class="modal-close" onclick="closeModal('rename-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body">
                <form id="rename-form">
                    <input type="hidden" id="rename-filepath" name="filepath">
                    <div class="form-group">
                        <label for="rename-input" class="form-label">New Name:</label>
                        <input type="text" id="rename-input" name="new_name" class="form-input" required>
                    </div>
                    <div class="form-actions">
                        <button type="submit" class="button-primary">Rename</button>
                        <button type="button" class="button-secondary" onclick="closeModal('rename-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Move Modal -->
    <div id="move-modal" class="modal">
        <div class="modal-content" style="min-width: 600px; max-width: 800px;">
            <div class="modal-title-bar">
                <div class="modal-title-text">Move to Folder</div>
                <button class="modal-close" onclick="closeModal('move-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body" style="padding: 10px;">
                <form id="move-form">
                    <input type="hidden" id="move-filepath" name="filepath">
                    <input type="hidden" id="move-target-dir" name="target_dir" value="">
                    <div class="form-group" style="margin-bottom: 10px;">
                        <label class="form-label">Select Destination Folder:</label>
                        <div style="background: #c0c0c0; border: 1px inset #c0c0c0; padding: 4px; margin-bottom: 8px; font-size: 11px;">
                            <span id="move-current-path">/</span>
                        </div>
                        <div id="move-folder-browser" style="background: white; border: 1px inset #c0c0c0; height: 300px; overflow-y: auto; padding: 4px;">
                            <div style="text-align: center; padding: 20px; color: #808080;">Loading...</div>
                        </div>
                    </div>
                    <div class="form-actions">
                        <button type="button" class="button-secondary" onclick="moveBrowserGoUp()" id="move-browser-up" style="display: none;">‚Üë Up</button>
                        <button type="button" class="button-secondary" onclick="moveBrowserGoHome()">üè† Home</button>
                        <div style="flex: 1;"></div>
                        <button type="submit" class="button-primary" id="move-submit-btn" disabled>Move Here</button>
                        <button type="button" class="button-secondary" onclick="closeModal('move-modal')">Cancel</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Clipboard Indicator -->
    <div id="clipboard-indicator" class="clipboard-indicator" style="display: none;">
        <span id="clipboard-text"></span>
        <button onclick="clearClipboard()" class="clipboard-clear">√ó</button>
    </div>

    <!-- Notification Container -->
    <div id="notification-container" class="notification-container"></div>

    <!-- File Information Modal -->
    <div id="file-info-modal" class="modal">
        <div class="modal-content" style="min-width: 600px; max-width: 900px; max-height: 90vh;">
            <div class="modal-title-bar">
                <div class="modal-title-text">File Information</div>
                <button class="modal-close" onclick="closeModal('file-info-modal')" aria-label="Close">√ó</button>
            </div>
            <div class="modal-body" style="padding: 20px; overflow-y: auto;">
                <div id="file-info-content" style="font-size: 11px;">
                    <div style="text-align: center; padding: 20px; color: #808080;">Loading file information...</div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>

